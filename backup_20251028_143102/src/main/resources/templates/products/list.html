<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상품 목록 - LocalMarket</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
</head>
<body>
    <!-- 헤더 영역 -->
    <div th:replace="~{layout :: header}"></div>

    <!-- 히어로 섹션 -->
    <section class="hero-section">
        <div class="container">
            <h1 class="display-5 mb-3">신선한 상품들</h1>
            <p class="lead mb-0">전통시장의 신선하고 맛있는 상품들을 만나보세요</p>
        </div>
    </section>

    <!-- 필터 섹션 -->
    <section class="filter-section">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <form action="/products" method="get" class="d-flex">
                        <input type="text" name="search" class="form-control me-2" 
                               th:value="${search}" placeholder="상품명, 가게명으로 검색">
                        <select name="category" class="form-select me-2" style="max-width: 200px;">
                            <option value="">전체 카테고리</option>
                            <option value="농산물" th:selected="${category == '농산물'}">농산물</option>
                            <option value="수산물" th:selected="${category == '수산물'}">수산물</option>
                            <option value="축산물" th:selected="${category == '축산물'}">축산물</option>
                            <option value="가공식품" th:selected="${category == '가공식품'}">가공식품</option>
                            <option value="의류" th:selected="${category == '의류'}">의류</option>
                            <option value="기타" th:selected="${category == '기타'}">기타</option>
                        </select>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-search"></i> 검색
                        </button>
                    </form>
                </div>
                <div class="col-md-4 text-end">
                    <select class="form-select" onchange="location.href='/products?sort=' + this.value + getFilterParams()">
                        <option value="name" th:selected="${sort == 'name'}">이름순</option>
                        <option value="price_asc" th:selected="${sort == 'price_asc'}">가격 낮은순</option>
                        <option value="price_desc" th:selected="${sort == 'price_desc'}">가격 높은순</option>
                        <option value="created" th:selected="${sort == 'created'}">최신순</option>
                        <option value="popular" th:selected="${sort == 'popular'}">인기순</option>
                    </select>
                </div>
            </div>
            
            <div class="mt-3">
                <span class="text-muted">가격대 필터:</span>
                <a href="/products" class="btn btn-outline-secondary btn-sm filter-btn" 
                   th:classappend="${priceRange == null} ? 'active' : ''">전체</a>
                <a href="/products?priceRange=0-10000" class="btn btn-outline-secondary btn-sm filter-btn"
                   th:classappend="${priceRange == '0-10000'} ? 'active' : ''">1만원 이하</a>
                <a href="/products?priceRange=10000-30000" class="btn btn-outline-secondary btn-sm filter-btn"
                   th:classappend="${priceRange == '10000-30000'} ? 'active' : ''">1만원-3만원</a>
                <a href="/products?priceRange=30000-50000" class="btn btn-outline-secondary btn-sm filter-btn"
                   th:classappend="${priceRange == '30000-50000'} ? 'active' : ''">3만원-5만원</a>
                <a href="/products?priceRange=50000-" class="btn btn-outline-secondary btn-sm filter-btn"
                   th:classappend="${priceRange == '50000-'} ? 'active' : ''">5만원 이상</a>
            </div>
        </div>
    </section>

    <!-- 상품 목록 섹션 -->
    <section class="py-5">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3>상품 목록</h3>
                <span class="text-muted" th:text="'총 ' + ${#lists.size(products)} + '개의 상품'">총 0개의 상품</span>
            </div>
            
            <div class="row">
                <!-- 상품 카드 -->
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4" th:each="product : ${products}">
                    <div class="card product-card">
                        <div class="product-image" 
                             th:style="'background-image: url(' + ${product.imageUrl ?: '/images/default-product.jpg'} + ')'">
                            <div class="product-badge" th:if="${product.isOnSale}" th:text="'SALE'">SALE</div>
                            <div class="product-badge new" th:if="${product.isNew}" th:text="'NEW'">NEW</div>
                        </div>
                        <div class="product-info">
                            <h6 class="card-title" th:text="${product.productName}">상품명</h6>
                            
                            <div class="store-info mb-2">
                                <i class="fas fa-store"></i>
                                <span th:text="${product.storeName}">가게명</span>
                                <span class="rating ms-2">
                                    <i class="fas fa-star"></i>
                                    <span th:text="${product.rating ?: '0.0'}">0.0</span>
                                </span>
                            </div>
                            
                            <div class="price-info mb-3">
                                <span class="product-price" th:text="${#numbers.formatInteger(product.price, 0, 'COMMA')} + '원'">가격</span>
                                <div th:if="${product.originalPrice != null and product.originalPrice > product.price}">
                                    <span class="product-original-price" 
                                          th:text="${#numbers.formatInteger(product.originalPrice, 0, 'COMMA')} + '원'">원가</span>
                                    <span class="product-discount ms-2" 
                                          th:text="'(' + ${T(Math).round((product.originalPrice - product.price) * 100.0 / product.originalPrice)} + '% 할인)'">할인율</span>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <a th:href="@{/products/{id}(id=${product.productId})}" 
                                   class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-eye"></i> 상품 보기
                                </a>
                                <button class="btn btn-success btn-sm" 
                                        th:onclick="'addToCart(' + ${product.productId} + ')'">
                                    <i class="fas fa-cart-plus"></i> 장바구니
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 기본 상품 데이터 (products가 비어있을 때) -->
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4" th:if="${#lists.isEmpty(products)}">
                    <div class="card product-card">
                        <div class="product-image" style="background-image: url('/images/default-product.jpg')">
                            <div class="product-badge new">NEW</div>
                        </div>
                        <div class="product-info">
                            <h6 class="card-title">신선한 배추</h6>
                            <div class="store-info mb-2">
                                <i class="fas fa-store"></i> 김씨네 채소가게
                                <span class="rating ms-2">
                                    <i class="fas fa-star"></i> 4.5
                                </span>
                            </div>
                            <div class="price-info mb-3">
                                <span class="product-price">3,000원</span>
                            </div>
                            <div class="d-grid gap-2">
                                <a href="/products/1" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-eye"></i> 상품 보기
                                </a>
                                <button class="btn btn-success btn-sm" onclick="addToCart(1)">
                                    <i class="fas fa-cart-plus"></i> 장바구니
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4" th:if="${#lists.isEmpty(products)}">
                    <div class="card product-card">
                        <div class="product-image" style="background-image: url('/images/default-product.jpg')">
                            <div class="product-badge">SALE</div>
                        </div>
                        <div class="product-info">
                            <h6 class="card-title">국산 쌀 20kg</h6>
                            <div class="store-info mb-2">
                                <i class="fas fa-store"></i> 박씨네 정미소
                                <span class="rating ms-2">
                                    <i class="fas fa-star"></i> 4.8
                                </span>
                            </div>
                            <div class="price-info mb-3">
                                <span class="product-price">25,000원</span>
                                <div>
                                    <span class="product-original-price">30,000원</span>
                                    <span class="product-discount ms-2">(17% 할인)</span>
                                </div>
                            </div>
                            <div class="d-grid gap-2">
                                <a href="/products/2" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-eye"></i> 상품 보기
                                </a>
                                <button class="btn btn-success btn-sm" onclick="addToCart(2)">
                                    <i class="fas fa-cart-plus"></i> 장바구니
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4" th:if="${#lists.isEmpty(products)}">
                    <div class="card product-card">
                        <div class="product-image" style="background-image: url('/images/default-product.jpg')"></div>
                        <div class="product-info">
                            <h6 class="card-title">생선구이 세트</h6>
                            <div class="store-info mb-2">
                                <i class="fas fa-store"></i> 바다횟집
                                <span class="rating ms-2">
                                    <i class="fas fa-star"></i> 4.3
                                </span>
                            </div>
                            <div class="price-info mb-3">
                                <span class="product-price">8,000원</span>
                            </div>
                            <div class="d-grid gap-2">
                                <a href="/products/3" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-eye"></i> 상품 보기
                                </a>
                                <button class="btn btn-success btn-sm" onclick="addToCart(3)">
                                    <i class="fas fa-cart-plus"></i> 장바구니
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4" th:if="${#lists.isEmpty(products)}">
                    <div class="card product-card">
                        <div class="product-image" style="background-image: url('/images/default-product.jpg')"></div>
                        <div class="product-info">
                            <h6 class="card-title">수제 떡 모음</h6>
                            <div class="store-info mb-2">
                                <i class="fas fa-store"></i> 할머니 떡집
                                <span class="rating ms-2">
                                    <i class="fas fa-star"></i> 4.9
                                </span>
                            </div>
                            <div class="price-info mb-3">
                                <span class="product-price">12,000원</span>
                            </div>
                            <div class="d-grid gap-2">
                                <a href="/products/4" class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-eye"></i> 상품 보기
                                </a>
                                <button class="btn btn-success btn-sm" onclick="addToCart(4)">
                                    <i class="fas fa-cart-plus"></i> 장바구니
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 페이지네이션 -->
            <nav aria-label="상품 목록 페이지네이션" th:if="${totalPages > 1}">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                        <a class="page-link" th:href="@{/products(page=${currentPage - 1}, size=${size}, search=${search}, category=${category}, priceRange=${priceRange}, sort=${sort})}">이전</a>
                    </li>
                    
                    <li class="page-item" th:each="page : ${#numbers.sequence(0, totalPages - 1)}" 
                        th:classappend="${page == currentPage} ? 'active'">
                        <a class="page-link" th:href="@{/products(page=${page}, size=${size}, search=${search}, category=${category}, priceRange=${priceRange}, sort=${sort})}" 
                           th:text="${page + 1}">1</a>
                    </li>
                    
                    <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                        <a class="page-link" th:href="@{/products(page=${currentPage + 1}, size=${size}, search=${search}, category=${category}, priceRange=${priceRange}, sort=${sort})}">다음</a>
                    </li>
                </ul>
            </nav>
        </div>
    </section>

    <!-- 푸터 -->
    <footer class="footer bg-light">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5><i class="fas fa-store"></i> LocalMarket</h5>
                    <p>전통시장의 맛과 정을 온라인으로 만나보세요.</p>
                </div>
                <div class="col-md-4">
                    <h6>바로가기</h6>
                    <ul class="list-unstyled">
                        <li><a href="/about" class="text-decoration-none">소개</a></li>
                        <li><a href="/help" class="text-decoration-none">도움말</a></li>
                        <li><a href="/contact" class="text-decoration-none">연락처</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h6>정책</h6>
                    <ul class="list-unstyled">
                        <li><a href="/terms" class="text-decoration-none">이용약관</a></li>
                        <li><a href="/privacy" class="text-decoration-none">개인정보처리방침</a></li>
                    </ul>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">&copy; 2025 LocalMarket. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // 장바구니 추가 함수
        function addToCart(productId) {
            // TODO: 실제 장바구니 추가 기능 구현
            alert('상품이 장바구니에 추가되었습니다!');
        }
        
        // 필터 파라미터 유지 함수
        function getFilterParams() {
            const urlParams = new URLSearchParams(window.location.search);
            let params = '';
            
            if (urlParams.get('search')) params += '&search=' + urlParams.get('search');
            if (urlParams.get('category')) params += '&category=' + urlParams.get('category');
            if (urlParams.get('priceRange')) params += '&priceRange=' + urlParams.get('priceRange');
            
            return params;
        }
    </script>
</body>
</html>